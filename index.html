<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BuzzFeed ¬∑ Beauty Shopping Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.12);
      --border-subtle: rgba(148, 163, 184, 0.3);
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-muted: #6b7280;
      --danger: #f97373;
      --danger-soft: rgba(248, 113, 113, 0.1);
      --radius-xl: 20px;
      --radius-2xl: 26px;
      --buzzfeed-red: #ee3322;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      color: var(--text-main);
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app-root {
      width: 100%;
      max-width: 520px;
      min-height: 100dvh;
      max-height: 100dvh;
      background: radial-gradient(circle at top left, #4c1d95 0, #020617 40%, #020617 100%);
      display: flex;
      flex-direction: column;
      padding: 10px 10px 12px;
    }

    @media (min-width: 900px) {
      body {
        justify-content: center;
      }
    }

    .frame-inner {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-radius: 18px;
      padding: 10px 8px 8px;
      gap: 8px;
    }

    .top-safe {
      height: env(safe-area-inset-top, 4px);
    }

    .brand-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
      padding: 4px 4px 0;
    }

    .brand-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-logo-circle {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--buzzfeed-red);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 13px;
      font-weight: 800;
      box-shadow: 0 6px 14px rgba(238, 51, 34, 0.7);
    }

    .brand-name {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.03em;
      color: #fee2e2;
    }

    .brand-tag {
      font-size: 10px;
      color: var(--text-soft);
    }

    .brand-pill {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(248, 113, 113, 0.6);
      background: rgba(24, 24, 27, 0.75);
      color: #fecaca;
      white-space: nowrap;
    }

    .handoff {
      margin: 4px 4px 0;
      padding: 6px 8px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .handoff-copy {
      flex: 1;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .cta-btn {
      padding: 9px 12px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at 0% 0%, #fb7185 0, #c026d3 40%, #581c87 100%);
      color: #fdf2ff;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      white-space: nowrap;
    }

    .cta-btn.small {
      font-size: 10px;
      padding: 7px 10px;
    }

    .cta-btn-icon {
      font-size: 13px;
    }

    .cta-btn:active {
      transform: translateY(1px) scale(0.98);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 6px;
      padding: 2px 2px 0;
    }

    .header-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-width: 75%;
    }

    .headline {
      font-size: 17px;
      font-weight: 650;
      letter-spacing: 0.01em;
    }

    .headline-gradient {
      background: linear-gradient(to right, #f9fafb 0, #fb7185 40%, #f97316 100%);
      -webkit-background-clip: text;
      color: transparent;
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-soft);
    }

    .badge-beta {
      padding: 4px 8px;
      font-size: 10px;
      border-radius: 999px;
      border: 1px solid rgba(252, 165, 165, 0.7);
      background: rgba(76, 29, 149, 0.92);
      color: #fee2e2;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #fb7185;
      box-shadow: 0 0 10px rgba(248, 113, 113, 0.9);
    }

    .badge-label {
      white-space: nowrap;
    }

    .product-card {
      margin-top: 6px;
      padding: 10px;
      border-radius: var(--radius-2xl);
      background: radial-gradient(circle at top left, rgba(251, 113, 133, 0.32) 0, rgba(15, 23, 42, 1) 50%);
      border: 1px solid rgba(148, 163, 184, 0.45);
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .product-image {
      width: 70px;
      height: 70px;
      border-radius: 18px;
      background: radial-gradient(circle at 20% 0%, rgba(248, 250, 252, 0.55) 0, rgba(15, 23, 42, 1) 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    .product-image::after {
      content: "";
      position: absolute;
      width: 140%;
      height: 140%;
      background: radial-gradient(circle at 0% 0%, rgba(248, 250, 252, 0.35) 0, transparent 55%);
      opacity: 0.7;
      mix-blend-mode: screen;
      transform: translateY(-10%);
    }

    .product-meta {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .product-title {
      font-size: 14px;
      font-weight: 600;
      color: #e5e7eb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .product-retailer {
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 11px;
      color: var(--text-soft);
    }

    .pill strong {
      color: #f9fafb;
    }

    .price {
      font-weight: 600;
      color: #f9fafb;
      font-size: 13px;
    }

    .stock-ok {
      color: #bbf7d0;
    }

    .stock-bad {
      color: #fecaca;
    }

    .chat-wrapper {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      margin-top: 6px;
      gap: 6px;
    }

    .chat-window {
      flex: 1;
      min-height: 0;
      border-radius: var(--radius-xl);
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(31, 41, 55, 0.98);
      padding: 8px 8px 6px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-scroll {
      flex: 1;
      overflow-y: auto;
      padding: 2px 2px 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      scrollbar-width: thin;
      scrollbar-color: rgba(148, 163, 184, 0.4) transparent;
    }

    .chat-scroll::-webkit-scrollbar {
      width: 4px;
    }
    .chat-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    .chat-scroll::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.4);
      border-radius: 999px;
    }

    .chat-row {
      display: flex;
      gap: 5px;
    }

    .chat-row.assistant {
      justify-content: flex-start;
    }

    .chat-row.user {
      justify-content: flex-end;
    }

    .avatar {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, rgba(248, 250, 252, 0.45) 0, rgba(15, 23, 42, 1) 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .avatar-user {
      background: radial-gradient(circle at 30% 0%, rgba(248, 250, 252, 0.3) 0, rgba(37, 99, 235, 1) 55%);
      border-color: rgba(191, 219, 254, 0.8);
    }

    .bubble {
      max-width: 80%;
      padding: 8px 9px;
      border-radius: 16px;
      font-size: 12px;
      line-height: 1.35;
    }

    .bubble-assistant {
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.96);
      color: var(--text-main);
      border-bottom-left-radius: 4px;
    }

    .bubble-user {
      background: rgba(147, 51, 234, 0.98);
      color: #fdf2ff;
      border-bottom-right-radius: 4px;
    }

    .bubble small {
      display: block;
      font-size: 10px;
      margin-top: 4px;
      color: var(--text-soft);
    }

    .suggestion-list {
      margin-top: 4px;
      padding-left: 14px;
    }

    .suggestion-item {
      margin-bottom: 2px;
    }

    .suggestion-item strong {
      color: #e5e7eb;
    }

    .suggestion-item a {
      color: #fbbf24;
      text-decoration: none;
    }

    .suggestion-item a:hover {
      text-decoration: underline;
    }

    .price-highlight {
      color: #fed7aa;
      font-weight: 600;
    }

    .strike {
      text-decoration: line-through;
      opacity: 0.7;
    }

    .badge-small {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.96);
      margin-top: 4px;
    }

    .badge-small.good {
      border-color: rgba(234, 179, 8, 0.9);
      background: var(--accent-soft);
      color: #ffedd5;
    }

    .badge-small.bad {
      border-color: rgba(220, 38, 38, 0.9);
      background: var(--danger-soft);
      color: #fecaca;
    }

    .stock-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #eab308;
    }

    .stock-dot.bad {
      background: #dc2626;
    }

    .typing {
      display: inline-flex;
      gap: 2px;
      align-items: center;
    }

    .typing-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.7);
      animation: blink 1.3s infinite ease-in-out;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.18s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.36s;
    }

    @keyframes blink {
      0% { opacity: 0.25; transform: translateY(0); }
      50% { opacity: 1; transform: translateY(-1px); }
      100% { opacity: 0.25; transform: translateY(0); }
    }

    .quick-actions {
      margin-top: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .qa-btn {
      flex: 1 1 calc(50% - 4px);
      min-width: 0;
      padding: 7px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.98);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 64, 175, 0.98));
      color: var(--text-soft);
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 6px;
      cursor: pointer;
      outline: none;
    }

    .qa-btn span.icon {
      font-size: 13px;
    }

    .qa-btn strong {
      color: #e5e7eb;
      font-weight: 500;
      display: block;
    }

    .qa-btn small {
      font-size: 10px;
      color: var(--text-soft);
      display: block;
    }

    .qa-btn:active {
      transform: translateY(1px) scale(0.99);
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      padding-top: 6px;
    }

    .input-shell {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 5px 10px;
      background: rgba(15, 23, 42, 0.99);
      border: 1px solid rgba(31, 41, 55, 0.98);
    }

    .input-shell input {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--text-main);
      font-size: 12px;
      outline: none;
      padding: 3px 0;
    }

    .input-shell input::placeholder {
      color: var(--text-muted);
    }

    .send-btn {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #fb7185, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #320716;
      cursor: pointer;
      font-size: 14px;
      flex-shrink: 0;
    }

    .send-btn:active {
      transform: translateY(1px) scale(0.97);
    }

    @media (max-height: 640px) {
      .frame-inner {
        padding-top: 6px;
      }
      .product-card {
        padding: 8px;
      }
      .qa-btn {
        padding: 6px 7px;
      }
    }
  </style>
</head>
<body>
  <div class="app-root">
    <div class="frame-inner">
      <div class="top-safe"></div>

      <!-- Brand row -->
      <div class="brand-bar">
        <div class="brand-left">
          <div class="brand-logo-circle">B</div>
          <div>
            <div class="brand-name" id="brandName"></div>
            <div class="brand-tag" id="brandTag"></div>
          </div>
        </div>
        <div class="brand-pill" id="brandPill"></div>
      </div>

      <!-- Handoff and CTA -->
      <div class="handoff">
        <div class="handoff-copy" id="handoffCopy"></div>
        <button id="continueBtn" class="cta-btn small">
          <span id="continueLabel"></span>
          <span class="cta-btn-icon">‚ÜóÔ∏é</span>
        </button>
      </div>

      <!-- Header -->
      <div class="header">
        <div class="header-main">
          <div class="headline">
            <span id="headlinePrefix"></span>
            <span class="headline-gradient" id="headlineHighlight"></span>
          </div>
          <div class="subtitle" id="subtitle"></div>
        </div>
        <div class="badge-beta">
          <span class="badge-dot"></span>
          <span class="badge-label" id="badgeLabel"></span>
        </div>
      </div>

      <!-- Product summary -->
      <div class="product-card" id="productCard">
        <div class="product-image">
          ‚ú®
        </div>
        <div class="product-meta">
          <div class="product-title" id="productTitle"></div>
          <div class="product-retailer" id="productRetailer"></div>
          <div class="pill-row">
            <div class="pill">
              <span id="reviewStats"></span>
            </div>
            <div class="pill">
              <span class="price" id="productPrice"></span>
            </div>
          </div>
          <div class="pill-row">
            <div class="pill">
              <span id="skinTypeLabel"></span>
            </div>
            <div class="pill">
              <span class="stock-ok" id="stockStatusText"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat area -->
      <div class="chat-wrapper">
        <div class="chat-window">
          <div id="chatScroll" class="chat-scroll"></div>

          <!-- Quick actions -->
          <div class="quick-actions">
            <button class="qa-btn" data-action="reviews">
              <span class="icon">üìù</span>
              <span class="qa-text">
                <strong id="qaReviewsTitle"></strong>
                <small id="qaReviewsSubtitle"></small>
              </span>
            </button>
            <button class="qa-btn" data-action="bundles">
              <span class="icon">üß¥</span>
              <span class="qa-text">
                <strong id="qaBundlesTitle"></strong>
                <small id="qaBundlesSubtitle"></small>
              </span>
            </button>
            <button class="qa-btn" data-action="similar">
              <span class="icon">üîÅ</span>
              <span class="qa-text">
                <strong id="qaSimilarTitle"></strong>
                <small id="qaSimilarSubtitle"></small>
              </span>
            </button>
            <button class="qa-btn" data-action="betterPrice">
              <span class="icon">üè∑Ô∏è</span>
              <span class="qa-text">
                <strong id="qaPriceTitle"></strong>
                <small id="qaPriceSubtitle"></small>
              </span>
            </button>
            <button class="qa-btn" data-action="stock">
              <span class="icon">üì¶</span>
              <span class="qa-text">
                <strong id="qaStockTitle"></strong>
                <small id="qaStockSubtitle"></small>
              </span>
            </button>
          </div>

          <!-- Input row -->
          <div class="input-row">
            <div class="input-shell">
              <input id="userInput" type="text" />
            </div>
            <button id="sendBtn" class="send-btn" aria-label="Send">
              ‚¨ÜÔ∏é
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    //  HIGH LEVEL CONFIG BLOCK
    // =========================

    // All the ASINs in one place
    const ASINS = {
      main: "B0FH9PB6BL",          // main product
      fragranceFree: "B074PTZCNX", // alt 1
      glowDrop: "B09MZNYLT2",      // alt 2
      moisturizer: "B0DK41BDBD"     // alt 3
    };

    // Helper to build Amazon URLs from ASIN
    function amazonDp(asin) {
      return asin ? "https://www.amazon.com/dp/" + asin : "#";
    }

    // Main UI copy in one config
    const TEXT = {
      brandName: "BuzzFeed",
      brandTag: "You tapped this from a BuzzFeed article",
      brandPill: "Beauty pick",

      handoffCopy:
        "Answer your questions here, then continue to the retailer to complete your order.",

      headlinePrefix: "Your ",
      headlineHighlight: "beauty shopping assistant",
      subtitle:
        "Before you check out, get help with skin type, alternatives, and the best price.",

      badgeLabel: "AI preview",

      // Product summary
      productName: "RadianceBoost 15% Vitamin C Brightening Serum",
      retailerName: "Amazon",
      reviewStats: "‚òÖ 4.6 ¬∑ 4,812 reviews",
      skinTypeLabel: "Skin type: Normal ¬∑ Combination ¬∑ Dull",

      // Price
      price: 42.0,

      // Stock messages
      stockInStock: "In stock ¬∑ Ships in 1 to 2 days",
      stockBackorder: "Back order, ships in 2 to 3 weeks",
      stockOut: "Out of stock at Amazon",

      // Chat intro
      chatIntroLine1: "You clicked a beauty pick in a BuzzFeed article.",
      chatIntroLine2:
        "Before I send you to Amazon, your shopping assistant can help with reviews, routines, alternatives, and price.",
      chatIntroPrompt: "What would you like to do first?",

      // Input placeholder
      inputPlaceholder: 'Ask anything... "Is this ok for sensitive skin?"',

      // Quick action labels
      qa: {
        reviews: {
          title: "Read more reviews",
          subtitle: "Filter by skin type"
        },
        bundles: {
          title: "Build a routine",
          subtitle: "Cleanser, serum, SPF"
        },
        similar: {
          title: "Find alternatives",
          subtitle: "Similar formulas"
        },
        price: {
          title: "Check price",
          subtitle: "Other retailers"
        },
        stock: {
          title: "Stock check",
          subtitle: "Out of stock plan"
        }
      }
    };

    // =========================
    //  PRODUCT DATA
    // =========================

    const product = {
      name: TEXT.productName,
      retailer: TEXT.retailerName,
      currentRetailerUrl: amazonDp(ASINS.main),
      sku: "RB-VC15",
      price: TEXT.price,
      inStock: true,
      backorder: false,
      reviews: [
        {
          title: "Noticeable glow in 3 weeks",
          snippet:
            "My acne marks faded faster than usual and my foundation sits better. No stinging for my combo skin.",
          rating: 5,
          persona: "Combo skin with dark spots"
        },
        {
          title: "Good results but strong at first",
          snippet:
            "I had slight tingling the first few uses. Using it every other night and layering moisturizer helped a lot.",
          rating: 4,
          persona: "Mildly sensitive skin"
        },
        {
          title: "Nice under makeup",
          snippet:
            "Layers well under sunscreen and makeup without pilling. Gives a healthy sheen instead of oiliness.",
          rating: 5,
          persona: "Makeup wearer, normal skin"
        }
      ],
      bundles: [
        {
          name: "Gentle gel cleanser",
          price: 16.0,
          why: "cleans without stripping which helps vitamin C absorb better"
        },
        {
          name: "Ceramide barrier cream",
          price: 24.0,
          why: "supports barrier so active ingredients feel less irritating"
        },
        {
          name: "Lightweight SPF 50",
          price: 22.0,
          why: "locks in brightening results and protects against new spots"
        }
      ],
      // Alternatives with Amazon links built from ASINs
      similar: [
        {
          name: "RadianceBoost Vitamin C Serum (Fragrance Free)",
          price: 44.0,
          angle: "same brightening focus but gentler for sensitive skin",
          url: amazonDp(ASINS.fragranceFree)
        },
        {
          name: "GlowDrop 12% Vitamin C + E",
          price: 38.0,
          angle: "slightly lower strength with added antioxidants",
          url: amazonDp(ASINS.glowDrop)
        },
        {
          name: "DailyShield Vitamin C Moisturizer",
          price: 35.0,
          angle: "two in one moisturizer for very simple routines",
          url: amazonDp(ASINS.moisturizer)
        }
      ],
      altRetailers: [
        {
          name: "BeautyBay Street",
          price: 40.0,
          perk: "10 percent off first order and free samples",
          link: "https://www.amazon.com/s?k=vitamin+c+serum"
        },
        {
          name: "RadiantRoom",
          price: 39.0,
          perk: "free shipping over 35 dollars and deluxe mini gift",
          link: "https://www.amazon.com/s?k=brightening+serum"
        }
      ],
      oosAlternatives: [
        {
          name: "GlowDrop 12% Vitamin C + E",
          price: 38.0,
          angle: "very similar brightening effect and in stock this week",
          url: amazonDp(ASINS.glowDrop)
        },
        {
          name: "DailyShield Vitamin C Moisturizer",
          price: 35.0,
          angle: "simpler step for people who do not want a long routine",
          url: amazonDp(ASINS.moisturizer)
        }
      ]
    };

    // =========================
    //  APP LOGIC
    // =========================

    const chatScroll = document.getElementById("chatScroll");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const continueBtn = document.getElementById("continueBtn");

    function formatPrice(value) {
      return "$" + value.toFixed(2);
    }

    function initStaticUI() {
      // Top brand and header
      document.getElementById("brandName").textContent = TEXT.brandName;
      document.getElementById("brandTag").textContent = TEXT.brandTag;
      document.getElementById("brandPill").textContent = TEXT.brandPill;

      document.getElementById("handoffCopy").textContent = TEXT.handoffCopy;
      document.getElementById("continueLabel").textContent =
        "Continue ¬∑ " + formatPrice(TEXT.price);

      document.getElementById("headlinePrefix").textContent =
        TEXT.headlinePrefix;
      document.getElementById("headlineHighlight").textContent =
        TEXT.headlineHighlight;
      document.getElementById("subtitle").textContent = TEXT.subtitle;
      document.getElementById("badgeLabel").textContent = TEXT.badgeLabel;

      // Product header bits
      document.getElementById("productTitle").textContent = product.name;
      document.getElementById("productRetailer").textContent =
        "Retailer: " + product.retailer;
      document.getElementById("reviewStats").textContent = TEXT.reviewStats;
      document.getElementById("productPrice").textContent = formatPrice(
        product.price
      );
      document.getElementById("skinTypeLabel").textContent =
        TEXT.skinTypeLabel;

      // Stock label
      const stockText = document.getElementById("stockStatusText");
      if (!product.inStock) {
        stockText.textContent = TEXT.stockOut;
        stockText.classList.remove("stock-ok");
        stockText.classList.add("stock-bad");
      } else if (product.backorder) {
        stockText.textContent = TEXT.stockBackorder;
        stockText.classList.remove("stock-ok");
        stockText.classList.add("stock-bad");
      } else {
        stockText.textContent = TEXT.stockInStock;
        stockText.classList.remove("stock-bad");
        stockText.classList.add("stock-ok");
      }

      // Quick action labels
      document.getElementById("qaReviewsTitle").textContent =
        TEXT.qa.reviews.title;
      document.getElementById("qaReviewsSubtitle").textContent =
        TEXT.qa.reviews.subtitle;

      document.getElementById("qaBundlesTitle").textContent =
        TEXT.qa.bundles.title;
      document.getElementById("qaBundlesSubtitle").textContent =
        TEXT.qa.bundles.subtitle;

      document.getElementById("qaSimilarTitle").textContent =
        TEXT.qa.similar.title;
      document.getElementById("qaSimilarSubtitle").textContent =
        TEXT.qa.similar.subtitle;

      document.getElementById("qaPriceTitle").textContent =
        TEXT.qa.price.title;
      document.getElementById("qaPriceSubtitle").textContent =
        TEXT.qa.price.subtitle;

      document.getElementById("qaStockTitle").textContent =
        TEXT.qa.stock.title;
      document.getElementById("qaStockSubtitle").textContent =
        TEXT.qa.stock.subtitle;

      // Input placeholder
      userInput.setAttribute("placeholder", TEXT.inputPlaceholder);
    }

    function createMessageElement(role, html) {
      const row = document.createElement("div");
      row.className = "chat-row " + role;

      const avatar = document.createElement("div");
      avatar.className = "avatar " + (role === "user" ? "avatar-user" : "");
      avatar.textContent = role === "user" ? "You" : "AI";

      const bubble = document.createElement("div");
      bubble.className =
        "bubble " + (role === "user" ? "bubble-user" : "bubble-assistant");
      bubble.innerHTML = html;

      if (role === "assistant") {
        row.appendChild(avatar);
        row.appendChild(bubble);
      } else {
        row.appendChild(bubble);
        row.appendChild(avatar);
      }

      return row;
    }

    function appendMessage(role, html) {
      const el = createMessageElement(role, html);
      chatScroll.appendChild(el);
      chatScroll.scrollTop = chatScroll.scrollHeight;
    }

    function showTyping() {
      const row = document.createElement("div");
      row.className = "chat-row assistant typing-row";

      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.textContent = "AI";

      const bubble = document.createElement("div");
      bubble.className = "bubble bubble-assistant";
      bubble.innerHTML =
        '<div class="typing">' +
        '<div class="typing-dot"></div>' +
        '<div class="typing-dot"></div>' +
        '<div class="typing-dot"></div>' +
        "</div>";

      row.appendChild(avatar);
      row.appendChild(bubble);
      chatScroll.appendChild(row);
      chatScroll.scrollTop = chatScroll.scrollHeight;

      return row;
    }

    function removeTyping(row) {
      if (row && row.parentNode) {
        row.parentNode.removeChild(row);
      }
    }

    function handleReviews() {
      const first = product.reviews[0];
      const rest = product.reviews.slice(1);
      return (
        "Here is how people with different skin concerns feel about " +
        product.name.split(" Brightening")[0] +
        ":" +
        '<ul class="suggestion-list">' +
        '<li class="suggestion-item"><strong>' +
        first.title +
        "</strong> ¬∑ ‚òÖ" +
        first.rating +
        " from " +
        first.persona +
        "<br />‚Äú" +
        first.snippet +
        "‚Äù</li>" +
        rest
          .map(function (r) {
            return (
              '<li class="suggestion-item"><strong>' +
              r.title +
              "</strong> ¬∑ ‚òÖ" +
              r.rating +
              "<br />‚Äú" +
              r.snippet +
              "‚Äù</li>"
            );
          })
          .join("") +
        "</ul>" +
        '<small>I surfaced reviews that talk about glow, irritation, and how it wears under makeup so you can decide faster.</small>'
      );
    }

    function handleBundles() {
      return (
        "To get the best result from this serum, most people like to keep a simple routine:" +
        '<ul class="suggestion-list">' +
        product.bundles
          .map(function (b) {
            return (
              '<li class="suggestion-item"><strong>' +
              b.name +
              "</strong> ¬∑ about <span class=\"price-highlight\">" +
              formatPrice(b.price) +
              "</span><br />Why: " +
              b.why +
              ".</li>"
            );
          })
          .join("") +
        "</ul>" +
        '<small>On the retailer page you can add these as you pick your shade. This keeps your routine beginner friendly and does not overload your skin with actives.</small>'
      );
    }

    function handleSimilar() {
      return (
        "Want to compare before you commit? Here are similar alternatives:" +
        '<ul class="suggestion-list">' +
        product.similar
          .map(function (s) {
            return (
              '<li class="suggestion-item">' +
              '<strong><a href="' +
              s.url +
              '" target="_blank" rel="noopener noreferrer">' +
              s.name +
              "</a></strong>" +
              " ¬∑ about " +
              formatPrice(s.price) +
              "<br />" +
              "Best for: " +
              s.angle +
              ".</li>"
            );
          })
          .join("") +
        "</ul>" +
        '<small>Tap a product name to open it on Amazon in a new tab while keeping this assistant open.</small>'
      );
    }

    function handleBetterPrice() {
      const here = formatPrice(product.price);
      const bestAlt = product.altRetailers.reduce(function (best, r) {
        return r.price < best.price ? r : best;
      }, product.altRetailers[0]);
      const savings = product.price - bestAlt.price;

      return (
        "Here is a quick price check for this serum:" +
        '<ul class="suggestion-list">' +
        '<li class="suggestion-item">' +
        "<strong>" +
        product.retailer +
        "</strong> (current path) ¬∑ <span class=\"strike\">" +
        here +
        "</span>" +
        "</li>" +
        product.altRetailers
          .map(function (r) {
            return (
              '<li class="suggestion-item">' +
              '<strong><a href="' +
              r.link +
              '" target="_blank" rel="noopener noreferrer">' +
              r.name +
              "</a></strong>" +
              " ¬∑ <span class=\"price-highlight\">" +
              formatPrice(r.price) +
              "</span><br />" +
              "Perk: " +
              r.perk +
              ".</li>"
            );
          })
          .join("") +
        "</ul>" +
        '<div class="badge-small good">' +
        '<span class="stock-dot"></span>' +
        "Best value right now looks like " +
        bestAlt.name +
        " at " +
        formatPrice(bestAlt.price) +
        " which is about " +
        formatPrice(savings) +
        " less." +
        "</div>" +
        '<small>For this demo you will still go to Amazon. In production this step can route you straight to the best price without breaking BuzzFeed tracking.</small>'
      );
    }

    function handleStock() {
      if (!product.inStock || product.backorder) {
        const badgeClass = "badge-small bad";
        const dotClass = "stock-dot bad";
        const statusText = !product.inStock
          ? "Out of stock today"
          : "Back order only right now";
        return (
          "Quick stock check for " +
          product.retailer +
          ":" +
          '<div class="' +
          badgeClass +
          '">' +
          '<span class="' +
          dotClass +
          '"></span>' +
          statusText +
          " at " +
          product.retailer +
          "." +
          "</div>" +
          "<br />" +
          "Here are alternatives with similar benefits that you can actually get:" +
          '<ul class="suggestion-list">' +
          product.oosAlternatives
            .map(function (a) {
              return (
                '<li class="suggestion-item">' +
                '<strong><a href="' +
                a.url +
                '" target="_blank" rel="noopener noreferrer">' +
                a.name +
                "</a></strong>" +
                " ¬∑ " +
                formatPrice(a.price) +
                "<br />" +
                "Why: " +
                a.angle +
                ".</li>"
              );
            })
            .join("") +
          "</ul>" +
          '<small>Tap a product name to open it on Amazon. In a live setup, I can send you straight to one of these in stock options and still keep the original BuzzFeed click information.</small>'
        );
      }
      return (
        "Good news. This serum is showing as:" +
        '<div class="badge-small good">' +
        '<span class="stock-dot"></span>' +
        "In stock at " +
        product.retailer +
        ", estimated delivery in 2 to 4 days." +
        "</div>" +
        "<br />" +
        '<small>If it sells out while you browse, I can automatically surface close alternatives that are ready to ship.</small>'
      );
    }

    function generateFreeformAnswer(question) {
      const q = question.toLowerCase();
      if (q.indexOf("review") !== -1 || q.indexOf("reviews") !== -1 || q.indexOf("good") !== -1) {
        return handleReviews();
      }
      if (
        q.indexOf("bundle") !== -1 ||
        q.indexOf("routine") !== -1 ||
        q.indexOf("together") !== -1
      ) {
        return handleBundles();
      }
      if (
        q.indexOf("similar") !== -1 ||
        q.indexOf("alternative") !== -1 ||
        q.indexOf("compare") !== -1
      ) {
        return handleSimilar();
      }
      if (
        q.indexOf("price") !== -1 ||
        q.indexOf("cheaper") !== -1 ||
        q.indexOf("deal") !== -1
      ) {
        return handleBetterPrice();
      }
      if (
        q.indexOf("stock") !== -1 ||
        q.indexOf("available") !== -1 ||
        q.indexOf("back order") !== -1
      ) {
        return handleStock();
      }
      if (
        q.indexOf("sensitive") !== -1 ||
        q.indexOf("irritation") !== -1 ||
        q.indexOf("burn") !== -1
      ) {
        return (
          "For sensitive skin the main questions are strength, texture, and how you layer it." +
          '<ul class="suggestion-list">' +
          '<li class="suggestion-item"><strong>Strength</strong> ¬∑ This is 15 percent vitamin C which is active but still in a range most mildly sensitive users tolerate if they go slow.</li>' +
          '<li class="suggestion-item"><strong>How to start</strong> ¬∑ Use it every other morning on dry skin, followed by barrier cream and sunscreen.</li>' +
          '<li class="suggestion-item"><strong>Back up option</strong> ¬∑ If you are very reactive, the fragrance free or lower strength alternatives I mentioned are safer starting points.</li>' +
          "</ul>" +
          '<small>If you tell me your skin type and what else you use, I can suggest a simple routine using this or a similar serum.</small>'
        );
      }
      if (
        q.indexOf("makeup") !== -1 ||
        q.indexOf("foundation") !== -1 ||
        q.indexOf("under makeup") !== -1
      ) {
        return (
          "This serum is designed to sit well under makeup:" +
          '<ul class="suggestion-list">' +
          '<li class="suggestion-item"><strong>Texture</strong> ¬∑ Lightweight and not oily once it sets, which helps foundation glide on.</li>' +
          '<li class="suggestion-item"><strong>Layering order</strong> ¬∑ Cleanser, serum, light moisturizer, then sunscreen. Makeup goes last.</li>' +
          '<li class="suggestion-item"><strong>Pilling check</strong> ¬∑ Reviews call out that it does not pill with most silicone based primers.</li>' +
          "</ul>" +
          '<small>If your base is very matte, a hydrating primer on top of this can keep things from looking flat.</small>'
        );
      }
      return (
        "I can help you decide if this serum fits your skin and budget:" +
        '<ul class="suggestion-list">' +
        "<li class=\"suggestion-item\">See focused reviews for your skin type and main concern.</li>" +
        "<li class=\"suggestion-item\">Build a simple routine around this so you know what to pair it with.</li>" +
        "<li class=\"suggestion-item\">Find close alternatives or more affordable options at other retailers.</li>" +
        "<li class=\"suggestion-item\">Avoid dead ends if it is out of stock by routing you to similar in stock formulas.</li>" +
        "</ul>" +
        '<small>Try asking ‚ÄúIs this ok for sensitive skin?‚Äù, ‚ÄúWhat routine should I use with this?‚Äù, or tap one of the quick actions above.</small>'
      );
    }

    function handleSend(text) {
      const trimmed = text.trim();
      if (!trimmed) return;

      appendMessage("user", trimmed);
      userInput.value = "";

      const typingRow = showTyping();

      setTimeout(function () {
        removeTyping(typingRow);
        const answer = generateFreeformAnswer(trimmed);
        appendMessage("assistant", answer);
      }, 650);
    }

    function onQuickActionClick(action) {
      let userPromptLabel = "";
      let answerHtml = "";

      if (action === "reviews") {
        userPromptLabel = "Show me reviews for my skin type.";
        answerHtml = handleReviews();
      } else if (action === "bundles") {
        userPromptLabel = "What else should I use with this serum?";
        answerHtml = handleBundles();
      } else if (action === "similar") {
        userPromptLabel = "Are there any similar alternatives to this serum?";
        answerHtml = handleSimilar();
      } else if (action === "betterPrice") {
        userPromptLabel = "Is there a better price somewhere else?";
        answerHtml = handleBetterPrice();
      } else if (action === "stock") {
        userPromptLabel = "What happens if this is out of stock?";
        answerHtml = handleStock();
      }

      appendMessage("user", userPromptLabel);

      const typingRow = showTyping();
      setTimeout(function () {
        removeTyping(typingRow);
        appendMessage("assistant", answerHtml);
      }, 550);
    }

    sendBtn.addEventListener("click", function () {
      handleSend(userInput.value);
    });

    userInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSend(userInput.value);
      }
    });

    document.querySelectorAll(".qa-btn").forEach(function (btn) {
      btn.addEventListener("click", function () {
        const action = btn.getAttribute("data-action");
        onQuickActionClick(action);
      });
    });

    continueBtn.addEventListener("click", function () {
      window.location.href = product.currentRetailerUrl;
    });

    function initChat() {
      const intro =
        TEXT.chatIntroLine1 +
        " " +
        TEXT.chatIntroLine2 +
        "<br /><br />" +
        TEXT.chatIntroPrompt;
      appendMessage("assistant", intro);
    }

    // Init
    initStaticUI();
    initChat();
  </script>
</body>
</html>



